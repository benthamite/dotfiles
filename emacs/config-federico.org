#+title: Fede's config

* tangle flags

#+begin_src emacs-lisp :tangle (if (eq tlon-init-extra-config-tangle-pass 1) (print tlon-init-tangle-flags-path) "no")
(
 (:ps/aide . nil)
 (:ps/anki-editor . nil)
 (:ps/auto-commit-mode . nil)
 (:ps/bbdb . nil)
 (:ps/copilot . nil)
 (:ps/corfu-doc-terminal . nil)
 (:ps/corfu-terminal . nil)
 (:ps/erc . nil)
 (:ps/espotify . nil)
 (:ps/frame . t)
 (:ps/forge . t)
 (:ps/git-auto-commit-mode . nil)
 (:ps/hammy . nil)
 (:ps/keytar . nil)
 (:ps/midnight . nil)
 (:ps/mixed-pitch . nil)
 (:ps/mu4e . nil)
 (:ps/mullvad . t)
 (:ps/ns-win . nil)
 (:ps/org-gcal . nil)
 (:ps/org-roam . nil)
 (:ps/org2blog . nil)
 (:ps/orgmdb . nil)
 (:ps/outline . nil)
 (:ps/pdf-tools . t)
 (:ps/puni . nil)
 (:ps/remember . nil)
 (:ps/server . nil)
 (:ps/slack . nil)
 (:ps/spelling . nil)
 (:ps/tlon . nil)
 (:ps/tlon-init . t)
 (:ps/theme-loaddefs . nil)
 (:ps/twittering-mode . nil)
 (:ps/vulpea . nil)
 (:ps/window . t)
 )
#+end_src

* variables override                                                  :crypt:
-----BEGIN PGP MESSAGE-----

hQIMAxRs/nzf4knaAQ/+OsFpK9yOt9UtO/SBmCzur52g4CZeq1qnceqyCAbd8o11
2IkX1QiHMsx32KDcONRsP24BNitkp7hKAe2EMi0H1o8pJYyo6OfvGMrpif3vISR8
Xxxo9ON0eN8vwZ5WM04qJPH9FrEmIU6A6cTsG99DUyl9tbGXzYF5TJcnCmnIeVax
5UMINsdaHqTIo9PNAPYfj97Ol5deYag9jQh+TP6R47OOjwPQ+5F34+sq3DzSP4B7
rjrqR5brLT9mNeBnmomNsjj7Q4gKEE+bHEyXCquFJf3JJfjhccU0WDF3lusT76TM
csHlIwk+B+ZjbYKXy8Um+GDnMO2WVyVcgXsNHBQ1oHo/N9qOlZNT7y+ObOQPZ0xe
xvgKuwzYzaoCU2SPsueTkrcxAPQfAZSHvHceOcaKY8pvygOojkz+e3XN7xo0in5V
fsupLlXNUnF2YkoHrTaQazYsPs2f9ypTx3NKURBC23/EsXkdJpoizPW3o3k29Xk6
W8qRdwUahgdH4Dlx8GJe8seFr7M5HGIxfNF4pZIC/7CNnAyQkBhL/0f2P744OlUJ
E77SXTravA99si4V0P+bztY5pxM126ZFSCCvDpeXCSRpNg2Uwq1K+xrnq/lFulzD
Yqh5vSmiDW4l9FsoTRR9ZSCa/f0Z7UO+UejEqcoK+jlOKBamItov7/cUgswNofPU
6QEJAhANMe6I9rzfSWZA00PGdPgfKd9zRqecvnVN5iaDqbKaiZgrmKKGRt4qoIJd
Koj4qejuKoiZS9aIma5Uu4s/Do0/Owxk5kxdmTwXmy3kYWQ+6VNoGqLGsIU6zgF+
H4jgMEZ/hqzNHKcZmBwt/DLdh2I7zazLiOmfVImId/argHBWpkyJLLwLuQjlkbId
Ii21LZARaT6ZKGTE/PTqbdjcydjptsGt+c7Sb59wgZC/ZMLMJqreyt3gvLH6iRJy
Tv0jR4VNUqUH6cYjvL/QxL1FZAkPPp55D//OIGttDpb+BuaawlCsWA2ocKH2gEXk
U2fjW8aBOELIVJ4jUdAlAxHzO4ql4bFglBk1EpQ/iF+SKIOoVOAhow0g6ea4jEBm
emGarIAOZq4RTA0K6qDJ1ZIDqh5Lo6a9LPRxv6tpTZny0nt/5n8evtwytEm/9Azl
ywBUMGnefdWSuQx8lTq/4dGcHd10c5995uQIEt0eghwIk0CxCLUhkY/qlUESJNf/
dPNU4b6xds1s+OBs8pHQG8vVOqo307pqQbMxb5BPR6G/+PuB01Ltf4Zbj/4pRGSN
ouJ5aqUF0Iib0T+TXbCod5We9fL/aAIuFpUunQZQR6RNijGLAbfVz77ab6RAExhu
ltw9shWU5VuJOxZtpR/JHo6sQCv5xYwRbkDGikuvMzmawDci+d6Q0jpRLuNtgJiu
TNvnZuDhMFVgyF7nBAPg1P3PA7KEsuRGTLn+KlledX/xE1Vs1Kwj8JnPQ6v0DTxx
jIJ3IFHP1AkmJtUJeyqnn5GvQCGIknuphNaPUaaRWWiZvgN+brWiHDvLje+8oLD5
zMaglzlzBLhAZfjhL5cGOvJxuZb+OrCsCTgmQ/4Sjmb4cRuepzKeWS6wctBXYqJo
7IQRJ/3JywyaaPNkQQobxcTMzmiLjwpbpDWkg2q4QHPSZIDQ2IkkABFe6GxXNaKw
zZKmB8q/uUaDCYNempE4adKzuegd+80hBvKUb/A2f34stoK5vea7hJ8i
=STqc
-----END PGP MESSAGE-----

* code overrides

#+begin_src emacs-lisp :tangle (if (eq tlon-init-extra-config-tangle-pass 2) (print tlon-init-code-overrides-path) "no")
((:ps/org-id-add-ids-to-headings-in-file
  . ((ignore)))
 (:ps/zotra-startup
  . ((ignore)))
 (:ps/faces
  . ((set-face-attribute 'default nil :family ps/face-fixed-pitch :height 150)
     (set-face-attribute 'fixed-pitch nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-drawer nil :foreground "LightSkyBlue" :family ps/face-fixed-pitch :height 0.8)
     (set-face-attribute 'org-property-value nil :family ps/face-fixed-pitch :height 0.9)
     (set-face-attribute 'org-todo nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-archived nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-document-title nil :family ps/face-fixed-pitch :underline t :height 1.0)
     (set-face-attribute 'org-special-keyword nil :family ps/face-fixed-pitch :height 0.9)
     (set-face-attribute 'org-tag nil :family ps/face-fixed-pitch :height 0.8)
     (set-face-attribute 'org-code nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-1 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-2 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-3 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-4 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-5 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-6 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-7 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-level-8 nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-date nil :family ps/face-fixed-pitch :height 0.8)
     (set-face-attribute 'org-modern-date-active nil :family ps/face-fixed-pitch :height 0.9)
     (set-face-attribute 'org-modern-date-inactive nil :family ps/face-fixed-pitch :height 0.9)
     (set-face-attribute 'org-modern-tag nil :family ps/face-fixed-pitch :height 0.9)
     (set-face-attribute 'corfu-default nil :family ps/face-fixed-pitch :height 1.0)
     (set-face-attribute 'org-quote nil :family ps/face-fixed-pitch :height 1.0)
     (message "Loaded fede's override for faces")))
 (:ps/doom-modeline
  . ((setq doom-modeline-time nil)
     (setq doom-modeline-mu4e nil)
     (setq doom-modeline-buffer-encoding t)
     (setq doom-modeline-irc nil)
     (setq doom-modeline-irc-buffers nil)
     ;; (doom-modeline--flycheck-icon t)
     (setq doom-modeline-github t)
     (setq doom-modeline-github-interval (* 10 60))
     (setq doom-modeline-buffer-file-name-style 'truncate-nil)
     (remove-hook 'display-time-mode-hook 'doom-modeline-override-display-time-modeline)
     (remove-hook 'display-battery-mode-hook 'doom-modeline-override-battery-modeline)
     (remove-hook 'doom-modeline-mode-hook 'doom-modeline-override-display-time-modeline)
     (remove-hook 'doom-modeline-mode-hook 'doom-modeline-override-battery-modeline)
     (message "Loaded fede's override for doom-modeline")
     (add-hook 'doom-modeline-before-github-fetch-notification-hook #'auth-source-pass-enable)))
 (:ps/window-border
  . ((ignore)))
 (:ps/window-split
  . ((ignore)))
 (:ps/modus-themes-load
  . ((modus-themes-load-theme 'modus-vivendi)))
 (:ps/frame-maximize
  . ((ignore)))
 (:ps/org-fold
  . ((ignore))))
#+end_src

* post init

#+begin_src emacs-lisp :tangle (if (eq tlon-init-extra-config-tangle-pass 2) (print tlon-init-post-init-path) "no")
(setq inhibit-startup-screen t)
(add-to-list 'initial-frame-alist '(fullscreen . maximized))
(message "Loading fede's custom faces:")
(ps/faces-load-custom-faces)
(recentf-mode)
(when (eq system-type 'darwin) ;; mac specific settings
  (setq mac-right-option-modifier 'alt)
  (setq mac-command-modifier 'hyper)
  (setq mac-option-modifier 'meta)
  (setq mac-right-command-modifier 'super)
  (tool-bar-mode -1)

  (delete-selection-mode 1)
  (cua-selection-mode 1)
  ;; disable C-return or it will interfere with org
  (define-key cua-global-keymap (kbd "<C-return>") nil)
  (setq shift-select-mode t))

(ps/tab-bar-reset)

(general-define-key
 "<kp-delete>" 'delete-char
 "<home>" 'beginning-of-line
 "<end>" 'end-of-line
 "H-q" 'delete-window
 "H-w" 'ps/kill-this-buffer
 "H-k" 'hydra-org-work/body
 "H-o" 'find-file
 "H-/" 'comment-line
 "H-\\" 'ps/window-split-if-unsplit
 "H-;" 'hydra-org-work/body
 "H-g" nil
 "H-h" 'other-window
 "H-H" 'ps/window-buffer-move-dwim
 "A-s-j" 'org-clock-goto
 "A-s-x" 'org-clock-cancel
 "<M-right>" 'forward-word
 "<M-left>" 'backward-word
 "<M-H-SPC>" 'execute-extended-command
 "H-:" 'eval-expression
 "<M-backspace>" 'backward-kill-word
 "<M-delete>" 'kill-word
 "<C-delete>" nil
 "<C-left>" nil
 "<C-S-left>" nil
 "<C-right>" nil
 "<C-S-right>" nil
 "<C-up>" nil
 "<C-S-up>" nil
 "<C-down>" nil
 "<C-S-down>" nil)

(general-define-key
 :keymaps 'org-mode-map
 "M-<right>" nil
 "M-<left>" nil
 "M-<up>" nil
 "M-<down>" nil
 "M-S-<right>" nil
 "M-S-<left>" nil
 "M-S-<up>" nil
 "M-S-<down>" nil
 "H-<right>" 'org-metaright
 "H-<left>" 'org-metaleft
 "H-<up>" 'org-metaup
 "H-<down>" 'org-metadown
 "M-<right>" 'forward-word
 "M-<left>" 'backward-word)


(defhydra hydra-org-work
  (:hint nil
	 :idle 0
	 :color blue)
  "Tlön dashboard"
  ("b" (org-id-goto "33BFC41C-324A-47E1-A313-8233A36B2346") "BAE")
  ("r" (org-id-goto "87906C3B-B52B-4816-BCCA-BE3EA4B88968") "RAE")
  ("f" (org-id-goto "809F6C1D-DDF7-4C6B-BB84-FFC082BE8601") "FM")
  ("d" (org-id-goto "0079A5CD-A07B-4919-A76C-4F6E6841512D") "LBDLHD")
  ("u" (org-id-goto "B168E4F1-D2E1-4D59-B88C-4CF924E82624") "EAN")
  ("i" (org-id-goto "715D2C4E-4BEE-4EC4-B432-720DA35C21A9") "EAI")
  ("h" (org-id-goto "B157C986-D75D-4244-A522-43DCBA2F0C8E") "HEAR")
  ("g" (org-id-goto "97F7D54F-4F4A-45A4-9616-A0B548A049BE") "GPE")
  ("c" (org-id-goto "7EDB8441-7EFA-43CC-B3DE-5682D55BCEE1") "Core")
  )
(setq org-capture-templates
      `(("b" "Tlön: BAE" entry
	 (id "33BFC41C-324A-47E1-A313-8233A36B2346")
	 "** TODO %?\n" :prepend t)
	("r" "Tlön: RAE" entry
	 (id "87906C3B-B52B-4816-BCCA-BE3EA4B88968")
	 "** TODO %?\n" :prepend t)
	("f" "Tlön: FM" entry
	 (id "809F6C1D-DDF7-4C6B-BB84-FFC082BE8601")
	 "** TODO %?\n" :prepend t)
	("d" "Tlön: LBDLH" entry
	 (id "0079A5CD-A07B-4919-A76C-4F6E6841512D")
	 "** TODO %?\n" :prepend t)
	("u" "Tlön: EAN" entry
	 (id "B168E4F1-D2E1-4D59-B88C-4CF924E82624")
	 "** TODO %?\n" :prepend t)
	("i" "Tlön: EAI" entry
	 (id "715D2C4E-4BEE-4EC4-B432-720DA35C21A9")
	 "** TODO %?\n" :prepend t)
	("h" "Tlön: HEAR" entry
	 (id "B157C986-D75D-4244-A522-43DCBA2F0C8E")
	 "** TODO %?\n" :prepend t)
	("g" "Tlön: GPE" entry
	 (id "97F7D54F-4F4A-45A4-9616-A0B548A049BE")
	 "** TODO %?\n" :prepend t)
	("c" "Tlön: Core" entry
	 (id "7EDB8441-7EFA-43CC-B3DE-5682D55BCEE1")
	 "** TODO %?\n" :prepend t)
	))


(defvar ps/file-cookies (file-name-concat ps/dir-downloads "cookies.txt"))
(defun ps/internet-archive-download-ACSM ()
  "Download and open ACSM file from Internet Archive URL in kill
ring.

NB: You need to have previously borrowed the book for the command
to work. The command will work even if the book was borrowed for
one hour only."
  (interactive)
  (if (string-search "archive.org" (current-kill 0))
      (progn
	(let* ((prefix "https://archive.org/services/loans/loan/?action=media_url&identifier=")
	       (suffix "&format=pdf&redirect=1")
	       (id (replace-regexp-in-string
		    "\\(http.*?details/\\)\\([_[:alnum:]]*\\)\\(.*\\)"
		    "\\2"
		    (current-kill 0)))
	       (url (concat prefix id suffix))
	       (acsm-file (file-name-concat ps/dir-downloads "book.acsm")))
	  ;; Download the Internet Archive cookies to a file so `wget' can authenticate:
	  ;; askubuntu.com/questions/161778/how-do-i-use-wget-curl-to-download-from-a-site-i-am-logged-into
	  ;; Then replace the path below with the location of the downloaded cookies file.
	  (save-window-excursion
	    (let ((shell-command-buffer-name-async "*internet-archive-download-ACSM*"))
	      (async-shell-command
	       (format
		"wget --load-cookies='%s' '%s' -O '%s'"
		ps/file-cookies url acsm-file))
	      ;; (sleep-for 2)
	      ;; (async-shell-command
	      ;; (format
	      ;; "open %s"
	      ;; "/users/cartago/downloads/book.acsm"))
	      ))
	  (dired ps/dir-downloads)
	  ))
    (user-error "You forgot to copy the URL!")))

(setq-default org-support-shift-select 'always
	      org-replace-disputed-keys t)

(setq org-agenda-custom-commands
      '(("j" "Agenda + TODOs"
	 (
	  (tags-todo "+fede"
		     (;; (tags "fede")
		      (org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "Mensajes para Fede")))
	  (tags-todo "+pablo"
		     (;; (tags "fede")
		      (org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "Mensajes para Pablo")))
	  (tags-todo "TODO=\"TODO\"+FILE=\"/Users/fede/Library/CloudStorage/Dropbox/tlon/fede/tareas.org\""
		     ((org-agenda-max-entries 10)
		      (org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "TODO - Trabajo")))
	  (tags-todo "TODO=\"TODO\"+FILE=\"/Users/fede/Library/CloudStorage/Dropbox/org/todo.org\""
		     ((org-agenda-max-entries 10)
		      (org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "TODO - Personal")))
	  (tags-todo "+SCHEDULED<=\"<today>\""
		     ((org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "Scheduled for today")))
	  (tags-todo "+DEADLINE<=\"<today>\" +DEADLINE>=\"<today -2m>\""
		     ((org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "Upcoming deadlines")))
	  (agenda "" ((org-agenda-span 14)))
	  (todo "WAITING"
		((org-agenda-overriding-header "WAITING")))
	  (tags-todo "TODO=\"TODO\"+FILE=\"/Users/fede/Dropbox/tlon/fede/tareas.org\""
		     ((org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "TODO - Trabajo - Todos")))
	  (tags-todo "TODO=\"TODO\"+FILE=\"/Users/fede/Dropbox/org/todo.org\""
		     ((org-agenda-sorting-strategy '(priority-down todo-state-down))
		      (org-agenda-overriding-header "TODO - Personal - Todos")))
	  ))))


(setq telega-server-libs-prefix "/Users/fede/source/td/tdlib")
(setq mac-function-modifier '(:button 2))
(setq real-auto-save-interval 10)


(defhydra hydra-dired
  (:exit t)
  "Dired folders"
  ("t" (hydra-dired-tlon-dropbox/body) "Tlön Dropbox" :column "Folders")
  ("g" (hydra-dired-tlon-google-drive/body) "Tlön Google Drive" :column "Folders")
  ("w" (dired (file-name-concat (getenv "HOME") "www")) "Nginx www root" :column "Folders")
  ("o" (dired ps/dir-google-drive) "Google Drive" :column "User")
  ("w" (dired ps/dir-downloads) "Downloads" :column "User")
  ("x" (dired ps/dir-dropbox) "Dropbox" :column "User")
  ("s" (dired (file-name-concat (getenv "HOME") "source")) "Source" :column "Folders")
  ("." (dired-at-point) "File at point" :column "Other")
  ("/" (dired "/") "Root" :column "Other")
  ("SPC" (dired "~/") "user" :column "User" )
  (";" (dired-jump) "Current buffer" :column "Other")
  ("H-;" (dired-jump-other-window) "Current buffer in other window" :column "Other")
  ("e" (dired ps/dir-emacs) "Emacs" :column "Config")
  ("p" (dired (file-name-concat (getenv "HOME") ".config/emacs-profiles")) "Emacs profiles" :column "Config")
  ("b" (dired (file-name-concat (getenv "HOME") "source/dotfiles/emacs")) "Pablo's Emacs config" :column "Config"))


(defhydra hydra-dired-tlon-dropbox
  (:exit t)
  "Dired folders: Tlön Dropbox"
  (";" (dired ps/dir-dropbox-tlon) "This folder")
  ("b" (dired ps/dir-dropbox-tlon-BAE) "BAE")
  ("c" (dired ps/dir-dropbox-tlon-core) "core")
  ("d" (dired ps/dir-dropbox-tlon-LBDLH) "LBDLH")
  ("f" (dired ps/dir-dropbox-tlon-fede) "fede")
  ("g" (dired ps/dir-dropbox-tlon-GPE) "GPE")
  ("h" (dired ps/dir-dropbox-tlon-HEAR) "HEAR")
  ("l" (dired ps/dir-dropbox-tlon-leo) "leo")
  ("p" (dired ps/dir-dropbox-tlon-LP) "LP")
  ("r" (dired ps/dir-dropbox-tlon-RAE) "RAE")
  ("s" (dired ps/dir-dropbox-tlon-FM) "FM")
  ("u" (dired ps/dir-dropbox-tlon-EAN) "EAN"))

(defhydra hydra-dired-tlon-google-drive
  (:exit t)
  "Dired folders: Tlön Google Drive"
  (";" (dired ps/dir-google-drive-tlon) "This folder")
  ("b" (dired ps/dir-google-drive-tlon-BAE) "BAE")
  ("c" (dired ps/dir-google-drive-tlon-core) "core")
  ("d" (dired ps/dir-google-drive-tlon-LBDLH) "LBDLH")
  ("f" (dired ps/dir-google-drive-tlon-fede) "fede")
  ("g" (dired ps/dir-google-drive-tlon-GPE) "GPE")
  ("h" (dired ps/dir-google-drive-tlon-HEAR) "HEAR")
  ("l" (dired ps/dir-google-drive-tlon-leo) "leo")
  ("p" (dired ps/dir-google-drive-tlon-LP) "LP")
  ("r" (dired ps/dir-google-drive-tlon-RAE) "RAE")
  ("s" (dired ps/dir-google-drive-tlon-FM) "FM")
  ("u" (dired ps/dir-google-drive-tlon-EAN) "EAN"))

(setq org-structure-template-alist '(("a" . "export ascii")
                                     ("c" . "center")
                                     ("C" . "comment")
                                     ("e" . "example")
                                     ("E" . "export")
                                     ("h" . "export html")
                                     ("l" . "export latex")
                                     ("q" . "quote")
                                     ("s" . "src")
                                     ("se" . "src emacs-lisp")
                                     ("sj" . "src javascript")
                                     ("sp" . "src python")
                                     ("ss" . "src shell")
                                     ("sr" . "src ruby")
                                     ("v" . "verse")
                                     ("w" . "WP")))

(setq org-agenda-files '("/Users/fede/Library/CloudStorage/Dropbox/tlon/fede/tareas.org" "/Users/fede/Library/CloudStorage/Dropbox/org/todo.org"))
(setq org-agenda-files-excluded nil)
(scroll-bar-mode -1)
(use-feature org-fold
  :demand t
  :config
  (setq org-fold-catch-invisible-edits 'smart)
  (defun ps/org-fold-show-all-headings ())
  (defun ps/org-hide-properties ())
  (defun ps/org-hide-logbook ())
  (defun ps/org-show-properties ())
  (defun ps/org-show-logbook ())
  (defun ps/org-toggle-properties ())
  (defun ps/org-toggle-logbook ()))
#+end_src

* local variables
# Local Variables:
# eval: (ps/buffer-local-set-key (kbd "s-y") 'org-decrypt-entry)
# org-crypt-key: "tlon.shared@gmail.com"
# End:
